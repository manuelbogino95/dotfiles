#!/bin/bash
set -eufo pipefail

{{- if and (eq .chezmoi.os "darwin") .setSshKey }}

sshKeyPath="{{ .chezmoi.homeDir }}/.ssh/{{ .gitSigningKeyName }}"

if [ ! -f "$sshKeyPath" ]; then
  echo "🔑  SSH key setup is configured but not automated"
  echo "📋  To create your SSH key manually, run:"
  echo "     ssh-keygen -t ed25519 -C '{{ .email }}' -f '$sshKeyPath'"
  echo "     ssh-add --apple-use-keychain '$sshKeyPath'"
  echo "     pbcopy < '$sshKeyPath.pub'"
  echo "     open https://github.com/settings/ssh/new"
else
  echo "ℹ️  SSH key {{ .gitSigningKeyName }} already exists"
fi

{{ end -}}
